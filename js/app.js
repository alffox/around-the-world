var model = {

   "locations":[
      {
         "title": "Diamond Bar",
         "continent": "Americas",
         "country": "USA",
         "flag": "images/flags/us.svg",
         "country_code": "us",
         "state_name": "California",
         "state_code": "CA",
         "language": "en",
         "location": {
            "lat": 33.997762,
            "lon": -117.814565
         }
      },
      {
         "title": "Chicago",
         "continent": "Americas",
         "country": "USA",
         "flag": "images/flags/us.svg",
         "country_code": "us",
         "state_name": "Illinois",
         "state_code": "IL",
         "language": "en",
         "location": {
            "lat": 41.886448,
            "lon": -87.634293
         }
      },
      {
         "title": "Hamilton",
         "continent": "Americas",
         "country": "USA",
         "flag": "images/flags/us.svg",
         "country_code": "us",
         "state_name": "Ohio",
         "state_code": "OH",
         "language": "en",
         "location": {
            "lat": 39.399105,
            "lon": -84.56109
         }
      },
      {
         "title": "Raleigh",
         "continent": "Americas",
         "country": "USA",
         "flag": "images/flags/us.svg",
         "country_code": "us",
         "state_name": "North Carolina",
         "state_code": "NC",
         "language": "en",
         "location": {
            "lat": 35.802156,
            "lon": -78.708269
         }
      },
      {
         "title": "Markham",
         "continent": "Americas",
         "country": "Canada",
         "flag": "images/flags/ca.svg",
         "country_code": "ca",
         "state_name": "Ontario",
         "state_code": "ON",
         "language": "en",
         "location": {
            "lat": 43.85006,
            "lon": -79.363188
         }
      },
      {
         "title": "Recife",
         "continent": "Americas",
         "country": "Brazil",
         "flag": "images/flags/br.svg",
         "country_code": "br",
         "state_name": "Pernambuco",
         "state_code": "PE",
         "language": "pt",
         "location": {
            "lat": -8.034983,
            "lon": -34.917969
         }
      },
      {
         "title": "São Paulo",
         "continent": "Americas",
         "country": "Brazil",
         "flag": "images/flags/br.svg",
         "country_code": "br",
         "state_name": "São Paulo",
         "state_code": "SP",
         "language": "pt",
         "location": {
            "lat": -23.557027,
            "lon": -46.663198
         }
      },
      {
         "title": "Eschborn",
         "continent": "Europe",
         "country": "Germany",
         "flag": "images/flags/de.svg",
         "country_code": "de",
         "state_name": "Hesse",
         "state_code": "",
         "language": "de",
         "location": {
            "lat": 50.135794,
            "lon": 8.571555
         }
      },
      {
         "title": "Madrid",
         "continent": "Europe",
         "country": "Spain",
         "flag": "images/flags/es.svg",
         "country_code": "es",
         "state_name": "Community of Madrid",
         "state_code": "",
         "language": "es",
         "location": {
            "lat": 40.476303,
            "lon": -3.685699
         }
      },
      {
         "title": "London",
         "continent": "Europe",
         "country": "United Kingdom",
         "flag": "images/flags/gb.svg",
         "country_code": "gb",
         "state_name": "London",
         "state_code": "",
         "language": "en",
         "location": {
            "lat": 51.449215,
            "lon": -0.329519
         }
      },
      {
         "title": "Dublin",
         "continent": "Europe",
         "country": "Ireland",
         "flag": "images/flags/ie.svg",
         "country_code": "ie",
         "state_name": "Leinster",
         "state_code": "",
         "language": "en",
         "location": {
            "lat": 53.338277,
            "lon": -6.242025
         }
      },
      {
         "title": "Concorezzo",
         "continent": "Europe",
         "country": "Italy",
         "flag": "images/flags/it.svg",
         "country_code": "it",
         "state_name": "Monza Brianza",
         "state_code": "MB",
         "language": "it",
         "location": {
            "lat": 45.596258,
            "lon": 9.325988
         }
      },
      {
         "title": "Budapest",
         "continent": "Europe",
         "country": "Hungary",
         "flag": "images/flags/hu.svg",
         "country_code": "hu",
         "state_name": "Budapest",
         "state_code": "",
         "language": "hu",
         "location": {
            "lat": 47.553462,
            "lon": 19.078457
         }
      },
      {
         "title": "Paris",
         "continent": "Europe",
         "country": "France",
         "flag": "images/flags/fr.svg",
         "country_code": "fr",
         "state_name": "Île-de-France",
         "state_code": "",
         "language": "fr",
         "location": {
            "lat": 48.873782,
            "lon": 2.335101
         }
      },
      {
         "title": "Leiden",
         "continent": "Europe",
         "country": "The Netherlands",
         "flag": "images/flags/nl.svg",
         "country_code": "nl",
         "state_name": "South Holland",
         "state_code": "",
         "language": "nl",
         "location": {
            "lat": 52.160285,
            "lon": 4.512023
         }
      },
      {
         "title": "Casablanca",
         "continent": "Africa",
         "country": "Morocco",
         "flag": "images/flags/ma.svg",
         "country_code": "ma",
         "state_name": "Casablanca-Settat",
         "state_code": "",
         "language": "ar",
         "location": {
            "lat": 33.5866,
            "lon": -7.632392
         }
      },
      {
         "title": "Dalian",
         "continent": "Asia-Pacific",
         "country": "China",
         "flag": "images/flags/cn.svg",
         "country_code": "cn",
         "state_name": "Liaoning",
         "state_code": "",
         "language": "cn",
         "location": {
            "lat": 38.864052,
            "lon": 121.532561
         }
      },
      {
         "title": "Tokyo",
         "continent": "Asia-Pacific",
         "country": "Japan",
         "flag": "images/flags/jp.svg",
         "country_code": "jp",
         "state_name": "",
         "state_code": "",
         "language": "jp",
         "location": {
            "lat": 35.647141,
            "lon": 139.715772
         }
      },
      {
         "title": "Bangalore",
         "continent": "Asia-Pacific",
         "country": "India",
         "flag": "images/flags/in.svg",
         "country_code": "in",
         "state_name": "Karnataka",
         "state_code": "KA",
         "language": "en",
         "location": {
            "lat": 13.027935,
            "lon": 77.632167
         }
      },
      {
         "title": "Sydney",
         "continent": "Asia-Pacific",
         "country": "Australia",
         "flag": "images/flags/au.svg",
         "country_code": "au",
         "state_name": "New South Wales",
         "state_code": "NSW",
         "language": "en",
         "location": {
            "lat": -33.874336,
            "lon": 151.209425
         }
      },
      {
         "title": "Singapore",
         "continent": "Asia-Pacific",
         "country": "Singapore",
         "flag": "images/flags/sg.svg",
         "country_code": "sg",
         "state_name": "",
         "state_code": "",
         "language": "en",
         "location": {
            "lat": 1.304029,
            "lon": 103.834769
         }
      },
      {
         "title": "Dubai",
         "continent": "Asia-Pacific",
         "country": "United Arab Emirates",
         "flag": "images/flags/ae.svg",
         "country_code": "ae",
         "state_name": "",
         "state_code": "",
         "language": "ar",
         "location": {
            "lat": 25.090228,
            "lon": 55.152997
         }
      }
   ]

};

var octopus = {

    initData: function() {
        octopus.getLocations();
        view.renderLocations(locations);
        octopus.setCurrentLocation(locations, 0);
        octopus.getButtonsLocationData(locations);
        octopus.getDropdownLocationData(locations);
    },

    getLocations: function() {
        return locations = model.locations;
    },

    getButtonsLocationData: function(locations) {

        var checks = document.querySelectorAll('.btn');

        checks.forEach(function(check) {
            check.addEventListener('click', checkIndex);
        });

        function checkIndex(event) {
            var clickedLocationIndexPos = Array.from(checks).indexOf(event.target);
            octopus.setCurrentLocation(locations, clickedLocationIndexPos);
        }

    },

    getDropdownLocationData: function(locations) {

        var checks = document.querySelectorAll('.dropdown-item');

        checks.forEach(function(check) {
            check.addEventListener('click', checkIndex);
        });

        function checkIndex(event) {
            var clickedLocationIndexPos = Array.from(checks).indexOf(event.target);
            octopus.setCurrentLocation(locations, clickedLocationIndexPos);
        }

    },

    setCurrentLocation: function(locations, index) {
        var clickedLocationFlag = locations[index].flag;
        var clickedLocation = locations[index].title;
        var clickedLocationCountryCode = locations[index].country_code;
        var clickedLocationCountry = locations[index].country;
        var clickedLocationLat = locations[index].location.lat;
        var clickedLocationLon = locations[index].location.lon;

        view.renderLocationTop(clickedLocationFlag, clickedLocation, clickedLocationCountry);

        octopus.getNews(clickedLocationCountryCode);
        octopus.getWeather(clickedLocationCountryCode, clickedLocationLat, clickedLocationLon);
        octopus.getWebCam(clickedLocationLat, clickedLocationLon);
        octopus.getSetMap(clickedLocationLat, clickedLocationLon, clickedLocation);
        octopus.getWiki(clickedLocationCountry);
        octopus.getPictures(clickedLocationCountry);
    },

    getNews: function(clickedLocationCountryCode) {
        //$.getJSON("js/news.json", function(news) {
        //});
        //Actual method:
        $.ajax({
            url: `https://newsapi.org/v2/top-headlines?country=${clickedLocationCountryCode}&apiKey=a1bb66430a7249f9a4aee6be1d91aa99`,
            method: "GET",
            error: function() {
                console.log("there was an error");
            },
            success: function(news) {
                view.renderNews(news);
            }
        });
    },

    getWeather: function(clickedLocationCountryCode, clickedLocationLat, clickedLocationLon) {

        if (clickedLocationCountryCode === "us") {
            $.ajax({
                url: `http://api.openweathermap.org/data/2.5/weather?lat=${clickedLocationLat}&lon=${clickedLocationLon}&appid=${weatherAPIKey}&units=imperial`,
                method: "GET",
                error: function() {
                    console.log("there was an error");
                },
                success: function(weather) {
                    view.renderWeather(weather);
                }
            });
        } else {
            $.ajax({
                url: `http://api.openweathermap.org/data/2.5/weather?lat=${clickedLocationLat}&lon=${clickedLocationLon}&appid=${weatherAPIKey}&units=metric`,
                method: "GET",
                error: function() {
                    console.log("there was an error");
                },
                success: function(weather) {
                    view.renderWeather(weather);
                }
            });
        }
    },

    getWebCam: function(clickedLocationLat, clickedLocationLon) {

        var api = `https://webcamstravel.p.mashape.com/webcams/list/nearby=${clickedLocationLat},${clickedLocationLon},50/limit=1?show=webcams%3Aimage%2Clocation&amp;lang=en`;

        $.ajax({
            headers: {
                "X-Mashape-Key": webCamAPIKey,
                "X-Mashape-Host": "webcamstravel.p.mashape.com"
            },
            url: api,
            success: function(webcam) {
                view.renderWebCam(webcam);
            }
        });
    },

    getSetMap: function(clickedLocationLat, clickedLocationLon, clickedLocation) {
        var currentLatLng = {
            lat: clickedLocationLat,
            lng: clickedLocationLon
        };

        var map = new google.maps.Map(document.getElementsByClassName('map')[0], {
            center: currentLatLng,
            disableDefaultUI: true,
            zoom: 4,
            gestureHandling: 'greedy'
        });

        var marker = new google.maps.Marker({
            position: currentLatLng,
            map: map,
            title: clickedLocation
        });

    },

    getWiki: function(clickedLocationCountry) {

        $.ajax({
            url: `https://en.wikipedia.org/api/rest_v1/page/summary/${clickedLocationCountry}`,
            method: "GET",
            error: function() {
                console.log("there was an error");
            },
            success: function(wiki) {
                view.renderWiki(wiki);
            }
        });
    },

    getPictures: function(clickedLocationCountry) {
        $.ajax({
            url: `https://api.unsplash.com/search/photos?client_id=${unsplashAPIKey}&query=${clickedLocationCountry}`, //client-id=Access Key
            method: "GET",
            error: function() {
                console.log("there was an error");
            },
            success: function(pictures) {
                view.renderPictures(pictures);
            }
        });
    }

};

var view = {

    renderLocationTop: function(clickedLocationFlag, clickedLocation, clickedLocationCountry) {
        $('.flag-top').attr("src", clickedLocationFlag);
        $('.flag-top').attr("alt", "Flag of " + clickedLocationCountry);
        $('.location').text(clickedLocation +', '+ clickedLocationCountry);
    },

    renderLocations: function(locations) {

        for (var i = 0; i < locations.length; i++) {
            var placeFlag = locations[i].flag;
            var place = locations[i].title;
            var country = locations[i].country;

            $('.location-tags').append('<button type="button" class="btn btn-info m-1"><img class="img-fluid flag-button img-thumbnail mr-2" src="' + placeFlag + '" alt="Flag of ' + country + '">' + place + ', ' + country + '</button>');

            if (locations[i].continent === "Americas") {
                $('#americas').append('<a class="dropdown-item">' + place + ', ' + country + '</a>');
            } else if (locations[i].continent === "Europe") {
                $('#europe').append('<a class="dropdown-item" href="#">' + place + ', ' + country + '</a>');
            } else if (locations[i].continent === "Africa") {
                $('#africa').append('<a class="dropdown-item" href="#">' + place + ', ' + country + '</a>');
            } else if (locations[i].continent === "Asia-Pacific") {
                $('#asia-pacific').append('<a class="dropdown-item" href="#">' + place + ', ' + country + '</a>');
            }
        }
    },


    renderNews: function(news) {
        var $attribution = $('<p class="top">Free news API for Developers</p><h1>Powered by <a href="https://newsapi.org/">News API</a></h1>');
        $(".news").empty().append($attribution);

        for (var i = 0; i < 10; i++) {
            var author = news.articles[i].author;
            var title = news.articles[i].title;
            var description = news.articles[i].description;
            var artUrl = news.articles[i].url;

            var $author = $('<div class="author">Author: ' + author + "</div >");
            var $title = $("<a href=" + artUrl + '><div class="title">' + title + "</div ></a>");
            var $description = $("<a href=" + artUrl + '><div class="description">' + description + "</div ></a>");

            $(".news").append($author, $title, $description);
            //console.log(artUrl);
        }
    },

    renderWeather: function(weather) {

        $(".weather").empty();

        var place = weather.name;
        var temperature = weather.main.temp;
        var weatherdescription = weather.weather[0].main;
        var iconKey = weather.weather[0].icon;
        var iconURL = 'http://openweathermap.org/img/w/' + iconKey + '.png';

        $(".weather").append("<p>" + place + "</p>", "<p>" + temperature + "</p>", "<p>" + weatherdescription + "</p>", "<img src=" + iconURL + ">");
    },

    renderWebCam: function(webcam) {
        $(".webcam").empty();

        var webCamImageURL = webcam.result.webcams[0].image.current.preview;

        $(".webcam").append('<img class="img-fluid" src="' + webCamImageURL + '">');
    },

    renderWiki: function(wiki) {
        $(".wiki").empty();

        var wikiTitle = wiki.title;
        var wikiExtract = wiki.extract;
        var wikiUrl = wiki.content_urls.mobile.page;


        $(".wiki").append("<p>" + wikiTitle + "</p>", "<p>" + wikiExtract + "</p>", "<a href=" + wikiUrl + ">Find more ...</a>");

    },

    renderPictures: function(pictures) {



        $(".card-columns").empty();

        for (var i = 0; i < 10; i++) {

            var imgURL = pictures.results[i].urls.regular;

            $(".card-columns").append('<div class="card"><img class="card-img-top img-fluid" src=' + imgURL + ' alt="placeholder alt text"><div class="card-block"><h4 class="card-title">Card title</h4><p class="card-text">This card has supporting text below as a natural lead-in to additional content.</p><p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p></div></div>');
        }
    }

};

octopus.initData();